<!doctype html>
<html lang="en">
<head>
  <title><%= device?.name || 'Newswall' %></title>
  <link rel="stylesheet" href="https://kit.fontawesome.com/a22be8527e.css" crossorigin="anonymous">
  <%# Refresh this page every displayFor minutes and mark the current item as previous in query param so that we try to pick a different paper next time %>
  <meta http-equiv="refresh" content="<%=paper.displayFor * 60%>;?prev=<%=paper.id%>">
  <style>
    * {
      margin: 0;
    }
    .paper-container {
      height: <%=display.height%>px;
      width: <%=display.width%>px;
      border: 1px solid;
      overflow: hidden;
    }
    .paper-container img {
      height: 100%;
      width: 100%;
      object-fit: contain;
    }
    .paper-container .statusbar {
      <% statusBarFontSize = 10 %>
      position: absolute;
      font-size: <%=statusBarFontSize%>px;
      font-family: serif;
      padding-left: <%=statusBarFontSize%>px;
      top: <%=display.height - 2*statusBarFontSize%>px;
    }
  </style>
</head>
<body>
  <div class="paper-container">
    <img src="/archive/<%=paper.date%>/<%=paper.id%>.png" style="transform: scale(<%=paper.scale%>)" alt="Showing <%=paper.id%> for <%=paper.date%>">
    <div class="statusbar">
      <%=dayjs().add(paper.displayFor, 'minutes').tz(device?.timezone || dayjs.tz.guess()).format('h:mm A')%> <i class="fa-sharp fa-solid fa-rotate-right"></i>&emsp;
      <%
         // Display next refresh time, WiFi strength and battery level in the bottom left
         pick = (level, choices, buckets = [0, 10, 20, 40, 65, 90]) => choices[buckets.findLastIndex(x => level >= x)]
      %>
      <% if (device?.status?.updatedAt) {%><%=dayjs.duration(dayjs(device.status.updatedAt).diff(dayjs().add(paper.displayFor/2, 'minutes'))).humanize(true) %>:<% } %>
      <% if (device?.status?.wifi) {%><%=device.status.wifi%>% <i class="fa-regular fa-<%=pick(device.status.wifi, ['signal-slash', 'signal-fair', 'signal-weak', 'signal-good', 'signal-strong', 'signal'])%>"></i>&emsp;<% } %>
      <% if (device?.status?.battery) {%><%=device.status.battery%>% <i class="fa-regular fa-rotate-270 fa-battery-<%=pick(device.status.battery, ['empty', 'low', 'quarters', 'half', 'three-quarters', 'full'])%>"></i>&emsp;<% } %>
      <% if (device?.status?.temperature) {%><%= Math.round(device.showFahrenheit ? device.status.temperature*1.8 + 32 : device.status.temperature)%>Â°<%= device.showFahrenheit ? 'F' : 'C'%><% } %>
    </div>
  </div>
</body>
</html>
